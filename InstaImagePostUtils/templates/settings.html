<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Settings - Instagram Image Utilities</title>
    </head>
    <body>
        <h2>Processing Settings</h2>
        <div>
            <img src="{{ url_for('display_image',uuid=uuid,filename=filename_thumbnail) }}" style="max-width:{{ thumbnail_width }}px;width:100%">
        </div>
        <div>
            <form name="settings" method="post" action="{{ url_for('get_results') }}">
                <input type="hidden" id="uuid" name="uuid" value="{{ uuid }}">
                <input type="hidden" id="filename" name="filename" value="{{ filename }}">
                <input type="hidden" id="option" name="option" value="{{ option }}">
            {% if option == "FILL" %}
                <label for="output-ar-label">Output Aspect Ratio</label>
                <div id="output-ar-label">
                    <input type="radio" id="4-5" name="output-ar" value="4-5" checked>
                    <label for="4-5">4:5</label>
                    <input type="radio" id="1-1" name="output-ar" value="1-1">
                    <label for="1-1">1:1</label>
                    <input type="radio" id="5-4" name="output-ar" value="5-4">
                    <label for="5-4">5:4</label>
                    <input type="radio" id="3-2" name="output-ar" value="3-2">
                    <label for="3-2">3:2</label>
                    <input type="radio" id="16-9" name="output-ar" value="16-9">
                    <label for="16-9">16:9</label>
                </div>
                <label for="background-label">Fill Background</label>
                <div id="background-label">
                    <input type="radio" id="bg-blur" name="background" value="bg-blur" checked>
                    <label for="bg-blur">Gaussian Blur Background</label>
                    <input type="radio" id="bg-black" name="background" value="bg-black">
                    <label for="bg-black">Black Background</label>
                    <input type="radio" id="bg-white" name="background" value="bg-white">
                    <label for="bg-white">White Background</label>
                </div>
                <div id="blur-pt-id">
                    <label for="blur-pt">Blur Percentage</label>
                    <input type="range" id="blur-pt" name="blur-pt" value="50" min="1" max="100" oninput="this.nextElementSibling.value = this.value">
                    <output>50</output>
                </div>
                <div>
                    <button type="submit">Submit</button>
                </div>
            {% elif option == "SPLIT" %}
                <div>
                    <label for="n-split">Number of Final Images</label>
                    <input type="number" id="n-split" name="n-split" min="2" max="4" value="2">
                    <p id="ar-warn" style="color:red;">Output image aspect ratio is outside of Instagram's bounds.</p>
                </div>
                <label for="letterbox-label">Create Letterboxed Image?</label>
                <div id="letterbox-label">
                    <input type="radio" id="lb-none" name="letterbox" value="lb-none" checked>
                    <label for="lb-none">Do Not Create Letterboxed Image</label>
                    <input type="radio" id="lb-black" name="letterbox" value="lb-black">
                    <label for="lb-black">Black Background</label>
                    <input type="radio" id="lb-white" name="letterbox" value="lb-white">
                    <label for="lb-white">White Background</label>
                </div>
                <div>
                    <button type="submit">Submit</button>
                </div>
            {% endif %}
            </form>
        </div>
    </body>
    <script language="javascript">
        var rad = document.getElementsByName("background");
        var blur_e = document.getElementById("blur-pt-id");
        for (let i = 0; i < rad.length; i++) {
            rad[i].addEventListener('change', function() {
                if (this.value == "bg-blur") {
                    blur_e.style.display = "block";
                }
                else {
                    blur_e.style.display = "none";
                }
            });
        }

        const im_width = {{ im_width }};
        const im_height = {{ im_height }};
        const min_ar = {{ min_ar }};
        const max_ar = {{ max_ar }};
        var n_split = document.getElementById("n-split");
        var ar_warn = document.getElementById("ar-warn");
        var handle_n_split = function(event) {
            var n = n_split.value;
            split_width = Math.floor(im_width/n);
            split_ar = split_width / im_height
            if (split_ar > max_ar || split_ar < min_ar) {
                ar_warn.style.display = "block";
            }
            else {
                ar_warn.style.display = "none";
            }
         };

        n_split.addEventListener('change', handle_n_split);
        window.addEventListener('DOMContentLoaded', handle_n_split);

    </script>
</html>